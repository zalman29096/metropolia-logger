<% layout('./__layout/main.ejs') -%>

<nav class="navbar navbar-default">
	<div class="container-fluid">
		
		<div class="collapse navbar-collapse">
			<ul class="nav navbar-nav">
				<li class="dropdown" style = "border-right : 1px solid #CCC; margin-right : 10px;">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Application <span class="caret"></span></a>
					<ul class="dropdown-menu">
						<% apps.forEach(function(app){%>
						<li><a href="#" class = "app-select" data-apptoken = "<%- app.token%>" data-appname = "<%- app.name%>"><%- app.name%></a></li>
						<% });%>
					</ul>
				</li>
			</ul>
			<form class = "navbar-form " id = "search-form">
				<div class = "form-group" style = "width : 80%">
					<input class = "form-control" id = "searchCase" placeholder = "Type your search case..." style = "width : 100%" />
				</div>
				<div class = "form-group">
					<button type = "submit" class = "btn btn-primary btn-md"><i class = "glyphicon glyphicon-search"></i></button>
				</div>	
			</form>
			
		</div>
	</div>
</nav>
<hr/>
<div id = "search-result">

</div>

<script>
	var token = ""
	$(".app-select").click(function(e){
		e.preventDefault();
		$(this).parent("li").parent("ul").prev("a").html($(this).data("appname") + '  <span class="caret"></span>')
		token = $(this).data("apptoken")
	})
	$("#search-form").submit(function(e){
		e.preventDefault();
		$.ajax({
			url : "/search/getResult",
			type : "POST",
			data : {
				token : token,
				search : $("#searchCase").val()
			},
			success : function(data){
				$("#search-result").html(JSON.stringify(data.data, null, 4))
			}
		})
	})
</script>
